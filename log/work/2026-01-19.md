# 2026-01-19 工作日誌 (SynthBlockly)

## 重要更新
1.  **範例管理系統升級**：
    *   `exampleManager.js`: 改用 `Intl.Collator` 自然排序法，確保 `10`, `10-2`, `11` 順序正確。
    *   `exampleModal.js`: 在範例清單中自動加入「範例 X: 」前綴，提升可讀性。
    *   `exampleManager.js`: 強化 `formatName` 正則表達式，支援 `10-2_` 這種複雜前綴的移除。

2.  **教材範例優化 (10-1, 10-2)**：
    *   `10-1`: 於註解中詳細說明 `await` 積木在函式切換時產生微小延遲的原因。
    *   `10-2`: 重新製作為 **Bossa Nova AABAB 曲式**。展示如何用函式封裝 4 小節循環與終止式，並透過 `等待 1m` 進行結構化編曲。

4.  **重大 UI Bug 修復 (複製塌陷與捲動)**：
    *   **問題根源**：確定為 Blockly 在大量積木建立（Batch Creation）時的渲染競態條件（Race Condition），以及同步事件處理造成的 Layout Thrashing。
    *   **解決方案**：
        - 在 `blocklyManager.js` 的 `onWorkspaceChanged` 加入 **50ms 防抖 (Debounce)** 機制。
        - 於延遲後強制執行 **`workspace.getAllBlocks().forEach(b => b.render())`**。
    *   **效果**：成功修復了複製音序器時 Shadow Block 塌陷消失的問題，並解決了刪除積木時頁面自動捲動到頂部的困擾。

5.  **整合說明文件入口網頁 (Help System)**：
    *   實作 `helpModal.js`：利用 `import.meta.glob` 自動掃描 `public/docs/*_readme_*.html`。
    *   自動化選單：從檔名解析標題並根據語系過濾，實現「自動探索」新文件功能。
    *   Toolbar 整合：新增 `btnHelp` 按鈕並綁定動態載入邏輯，移除 index.html 內的舊版靜態 HTML。

## 檔案異動
- `SynthBlockly/js/core/exampleManager.js`
- `SynthBlockly/js/ui/exampleModal.js`
- `SynthBlockly/js/ui/helpModal.js` (NEW)
- `SynthBlockly/js/core/blocklyManager.js`
- `SynthBlockly/js/blocks/transport_blocks.js`
- `SynthBlockly/js/app.js`
- `SynthBlockly/js/ui/buttons.js`
- `SynthBlockly/index.html`
- `SynthBlockly/src/examples/10-1_Functions and Long Compositions.xml`
- `SynthBlockly/src/examples/10-2_Sequencer Arranger.xml`
- `SynthBlockly/public/docs/custom_sampler_en.md` (DELETED)

## 下一步建議
- 觀察 `block.render()` 在大工程（積木數量極多）時的效能表現，必要時可優化為只 render 新建立的積木。
- 實作 Sidechain Compression 相關積木。
- 讓 `sb_play_melody` 支援和弦符號解析。
