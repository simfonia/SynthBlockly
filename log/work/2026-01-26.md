## 2026-01-26 任務紀錄：效果器管理增強與鍵盤事件帽子化

### 1. 效果器鏈管理
- **sb_clear_effects**：實作了清除特定音軌效果器的積木。
- **AudioEngine 擴充**：`audioEngine.clearEffects(target)` 現在會正確 `dispose` 節點並呼叫 `_reconnectAll()` 恢復基礎音軌路徑。

### 2. 旋律解析優化 (Melody Parser)
- **預設時值**：`playMelodyString` 現在支援 `Em`, `C4` 等不帶後綴的輸入，預設視為 `4n` (四分音符)。
- **日誌警告**：若解析完全失敗，會使用 `LOG_MELODY_PARSE_ERR` 提示使用者無效的格式字串。

### 3. PC 鍵盤系統升級 (V2.1 Event-Driven)
- **帽子積木化**：新增 `sb_key_action_event` 帽子積木，讓按鍵觸發可以執行複雜的積木序列（如動作、變數操作等）。
- **動態選項 (Dynamic FieldDropdown)**：
    - 實作了自動掃描工作區 Mapping 積木的邏輯。
    - 下拉選單會過濾掉已被選用的按鍵，實現「按鍵池」管理。
    - 解決了 XML 載入時 `this.sourceBlock_` 為 null 導致的 `TypeError`。
- **底層分流**：`keyboardController.js` 現在優先處理 `keyActionMap` (帽子積木註冊的自訂邏輯)，次之為和弦映射，最後才是預設鋼琴鍵盤，且嚴格保護系統功能鍵 (方向鍵、移調等) 不被覆蓋。

### 4. UI 與效能修正
- **全域日誌清除**：`resetWorkspaceAndAudio` 現在會呼叫 `clearLogs()`，確保開新專案時清理所有一般、警告與錯誤日誌。
- **積木校準**：`sb_define_chord` 預設值改為 `CM7` [C4,E4,G4,B4]，顏色改為 `PERFORMANCE_HUE`。
- **重複 Log 修正**：移除 blocklyManager 中多餘的 `LOG_KEY_ACTION_REGISTERED`，統一由 audioEngine 層級發送。
