# 2026-01-21 工作日誌 (續)

## 完成事項
1.  **實作動態音源選擇器 (Dynamic Instrument Selector)**
    - **新積木 `sb_instrument_selector`**: 
        - 實作了自動掃描工作區的邏輯，涵蓋所有 5 種音源建立積木 (`synth`, `harmonic`, `additive`, `layered`, `sampler`)。
        - 預設包含 `Master` 選項並置於首位。
        - 採用「載入驗證邏輯」，確保 XML 載入時即使樂器定義尚未掃描到，也不會拋出 `unavailable option` 錯誤。
    - **整合應用**: 將 `sb_setup_effect` 的 `TARGET` 輸入端影子積木替換為 `sb_instrument_selector`，使用者現在可透過下拉選單直觀選擇效果套用目標。
    - **Toolbox 更新**: 將選擇器積木加入「音源 (Sources)」分類中，增加可用性。

2.  **修復音序器下拉選單 Bug**
    - 修復了 `sb_rhythm_source_selector` 在載入現有專案時，因動態選單尚未更新而導致的 `Cannot set the dropdown's value` 渲染錯誤。
    - 優化了選項產生器的健全度，確保當前值 (Current Value) 永遠被視為合法選項。

## 技術細節
- **動態選單安全機制**: 
  在 `FieldDropdown` 的 generator 函式中，透過 `this.getValue()` 取得當前欄位值，若該值不在掃描到的 `options` 陣列中，則主動 `push` 進去。這解決了 Blockly 在 XML 序列化與 UI 渲染之間的時序競爭問題。
- **影子積木替換**: 
  由原本的 `text` (String) 影子積木改為 `sb_instrument_selector` (String)，保持了類型的相容性，同時提供了更好的 UI 交互。

## 下一步
- 觀察使用者對於分軌效果控制的反饋。
- 準備開始 V2.0 核心架構的規劃與重構。