
## 2026-01-25 重構任務：V2.1 容器化架構全面部署

### 1. 核心架構改動
- **容器化邏輯**：樂器配置 (ADSR, Volume, Effects) 現在必須放置於 sb_instrument_container (局部) 或 sb_master_container (全域) 內。
- **全域約束掃描器**：於 locklyManager.js 加入全域變更監聽，對不在容器內的積木呼叫 setDisabledReason(true, 'invalid_container')，確保其立即變灰並停止產生代碼。
- **產生器重構**：所有樂器控制積木的產生器現在會透過 getContainerTarget() 自動回溯父容器名稱，不再需要手動輸入名稱。

### 2. 積木與 UI 修正
- **步進音序器來源選擇**：修復了 sb_rhythm_source_selector 在影子積木中的動態選單問題。改用雙欄位 (TYPE, CUSTOM_TYPE) 兼顧舊版 XML 相容性與新版動態掃描。
- **和弦演奏積木**：將 sb_play_chord_by_name 改為 jsonInit 定義，修復了「力度」標籤無法顯示的語系對接 Bug。
- **Tooltip 與語系**：修正所有翻譯檔中的 Tooltip 說明，移除過時的「全域/目標」描述。

### 3. 範例庫更新
- **全數轉換**：同步更新 src/examples/ 下 01-15 號範例至 V2.1 格式。
- **排程邏輯優化**：移除了 08, 09 等範例循環內部的「等待」積木，改用「第 N 小節」參數實現非阻塞式精準排程。
### 4. 旋律字串功能增強 (Chord Name Support)
- **解析器升級**：AudioEngine.js 的 playMelodyString 現在支援 和弦名稱 + 時值 的複合格式（例如 Cmaj7H, AmQ）。
- **衝突避讓邏輯**：實作優先權辨識，若字串符合 [A-G][#b][0-8] 格式則強制判定為單音，其餘則查詢和弦字典，確保 C4 等基本音符不會被同名的自訂和弦覆蓋。
- **教學文件同步**：更新 melody_readme_*.html，加入「混合旋律與和弦」的範例（如 C4Q CM7H）以及命名衝突的預防建議。
- **UI 提示優化**：積木 Tooltip 現在會顯示支援自訂和弦名稱。
