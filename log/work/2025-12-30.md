# 2025-12-30 工作日誌 (SynthBlockly)

## 本次完成任務
- **日誌系統全面分層化與多語系化**:
    - 實作「錯誤/警告」(上方) 與「一般訊息」(下方) 的雙區塊顯示邏輯。
    - **Logger 核心更新**: 支援 `warning` 類型，獨立設定行數上限。
    - **多語系支援**: 移除所有硬編碼訊息，改用 `logKey` 配合 `en.js` / `zh-hant.js` 動態翻譯。支援參數插補（如樂器名稱）。
    - **UI 樣式優化**: 新增 `.log-important` 紅色文字樣式，並實作所有日誌類型的條紋底色。

- **音效播放 (SFX) 積木實作**:
    - 新增 `sb_play_sfx` 積木，支援預設音效選單與自訂 URL。
    - 支援 `Reverse` (反轉)、`Speed` (速度) 與 `Volume` (音量) 控制。
    - **架構強化**: 實作 `activeSFXPlayers` 追蹤機制，確保按下停止按鈕時能立即中斷所有載入中或播放中的音效。

- **ADSR 包絡視覺化 (重點功能)**:
    - 建立 `js/ui/adsrVisualizer.js`，使用 Canvas 繪製 A-D-S-R 四段式曲線。
    - **動態光點**: 實作粉紅色發光光點 (#FE2F89)，即時追蹤音符在包絡線上的狀態。
    - **即時預覽**: 實作 Blockly 監聽器，修改積木參數時圖表會立即連動，無需執行。
    - **自動同步**: 切換樂器時（積木或方向鍵），系統會自動回讀新樂器的 ADSR 並更新圖表。

- **UI 佈局重構**:
    - 工具列移至左側頂部，合併右側滑桿為同一列，優化筆電螢幕空間利用率。
    - 壓縮示波器與 ADSR 繪圖區高度，並使用 `flex-shrink: 0` 確保佈局穩定。

- **和弦系統 Bug 修復**:
    - 解決了和弦定義時的命名衝突與空格匹配問題，大幅提升了穩定性。

## 異動檔案
- `SynthBlockly/js/ui/logger.js`
- `SynthBlockly/js/ui/adsrVisualizer.js`
- `SynthBlockly/js/ui/keyboardController.js`
- `SynthBlockly/js/ui/uiManager.js`
- `SynthBlockly/js/ui/buttons.js`
- `SynthBlockly/js/core/audioEngine.js`
- `SynthBlockly/js/core/blocklyManager.js`
- `SynthBlockly/js/blocks/instruments_generators.js`
- `SynthBlockly/js/blocks/sfx_blocks.js`
- `SynthBlockly/js/blocks/sfx_generators.js`
- `SynthBlockly/js/blocks/index.js`
- `SynthBlockly/js/core/toolbox.js`
- `SynthBlockly/js/blocks/lang/en.js`
- `SynthBlockly/js/blocks/lang/zh-hant.js`
- `SynthBlockly/styles.css`
- `SynthBlockly/index.html`
