# 2026-01-01 工作日誌 (SynthBlockly)

## 本次完成任務
- **專業音訊術語與結構重構**:
    - 全面將「樂器 (Instrument)」更名為 **「音源 (Sound Source)」**，符合專業 DAW 術語。
    - **工具箱 (Toolbox) 三大支柱化**:
        - **音源建立 (Sources)**: 綠色 (#5CB85C)，收納所有合成器與取樣器建立積木。
        - **演奏與發聲 (Performance)**: 紅色 (#E74C3C)，收納所有播放與觸發積木。
        - **音源參數控制 (Control)**: 藍色 (#5BC0DE)，收納 ADSR、音量、顫音等控制積木。
    - 修正了 `toolbox.js` 中遺漏的「文字」與「列表」原生分類。

- **說明文件 (Docs) 風格統一化**:
    - 將 `docs/` 下所有 HTML 說明文件重構為一致的高級感視覺風格。
    - 標題顏色與對應積木色系同步（音源=綠、效果=紫、取樣=紅）。
    - 補全了 **「濾波器 (Filter)」** 所有模式的物理原理與參數詳解。
    - 統一命名規範為 `*_readme_{lang}.html`。

- **ADSR 視覺化深度優化**:
    - **介面壓縮**: 縮小示波器 (15vh) 與 ADSR (70px) 高度，為日誌區塊騰出空間。
    - **視覺歸一化**: 優化繪圖演算法，確保 A-D-S-R 四段寬度比例平衡且填滿畫布。
    - **即時連動**: 實作 Blockly 監聽器，修改積木參數時右側圖表立即反應，無需執行。
    - **自動同步**: 修復切換音源（方向鍵或積木）時，圖表無法自動回讀新音源 ADSR 狀態的 Bug。

- **系統穩定性與 Bug 修復**:
    - **自訂音源變調**: 修復了「加法合成器」不支援半音偏移 (`detune`) 的問題。
    - **和弦匹配**: 強化和弦名稱的 `trim()` 處理，解決因空格導致「和弦不存在」的報錯。
    - **音色殘留**: 修正切換音源時，舊音源未完全釋放導致的聲音重疊問題。
    - **日誌自動清理**: 確保「載入專案」與「執行」前都會清空錯誤日誌。
    - **多語系修正**: 補全了爵士鼓組件、音樂時值選單等遺漏的翻譯 Key。

- **旋律清單積木優化 (Melody List Block Optimization)**:
    - **動態 HelpUrl**: 為 `sb_play_melody` 積木加入了動態 `helpUrl` 設定，支援中英雙語文件連結。
    - **Tooltip 更新**: 補全休止符說明，並加入「可按右鍵選擇說明」的提示。
    - **文件整合**: 更新 `melody_readme` 文件，詳細列出「時值代碼表」，對照 Tone.js 標準寫法 (1m, 4n, 8t) 與積木代碼 (W, Q, E_T) 的關係，並解釋附點與三連音原理。

- **加法與減法合成教學文件**:
    - 在 `instrument_readme` (中/英) 文件末尾新增了「減法合成 vs 加法合成」的專章說明，以「雕刻」與「堆積木」的比喻幫助使用者理解。
    - 同步更新了「自訂波形樂器 (諧波/自由頻率)」積木的 `helpUrl`，使其指向這份包含原理說明的文檔。
    - 更新對應 Tooltip，加入右鍵說明提示。

- **使用者體驗 (UX) 優化**:
    - 為所有具有線上說明文件的積木 Tooltip 補上「按右鍵選擇「說明」查看詳細資訊」提示（中英雙語）。
    - **演奏積木說明 (Performance Guide)**:
        - 為 `sb_play_note` 與 `sb_play_note_and_wait` 新增專屬說明文件 (`performance_readme_*.html`)。
        - **時值符號詳解**: 補全了 Tone.js 標準時值符號說明，包含小節 (`m`)、音符 (`n`)、附點 (`.`) 與三連音 (`t`) 的語法與音樂意義對照表。
        - 解釋了阻塞與非阻塞行為的差異與適用情境。

## 異動檔案
- `SynthBlockly/js/core/audioEngine.js`
- `SynthBlockly/js/core/blocklyManager.js`
- `SynthBlockly/js/core/toolbox.js`
- `SynthBlockly/js/ui/adsrVisualizer.js`
- `SynthBlockly/js/ui/keyboardController.js`
- `SynthBlockly/js/ui/logger.js`
- `SynthBlockly/js/ui/uiManager.js`
- `SynthBlockly/js/ui/buttons.js`
- `SynthBlockly/js/blocks/instruments_blocks.js`
- `SynthBlockly/js/blocks/instruments_custom_wave_blocks.js`
- `SynthBlockly/js/blocks/sampler_blocks.js`
- `SynthBlockly/js/blocks/transport_blocks.js`
- `SynthBlockly/js/blocks/noise_blocks.js`
- `SynthBlockly/js/blocks/melody_blocks.js`
- `SynthBlockly/js/blocks/lang/zh-hant.js`
- `SynthBlockly/js/blocks/lang/en.js`
- `SynthBlockly/public/docs/*.html` (全部重構)
- `SynthBlockly/styles.css`
- `SynthBlockly/index.html`
- `SynthBlockly/log/todo.md`
- `SynthBlockly/FILE_STRUCTURE.md`
