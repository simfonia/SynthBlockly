<xml xmlns="https://developers.google.com/blockly/xml">
  <variables>
    <variable id="4kFk$B_8VRtg9#,1otIT">note</variable>
    <variable id="9:^.}}q,!02#XYYzHqxe">velocity</variable>
    <variable id="mJCT}0J}/8Z6sm[$fiQ=">channel</variable>
  </variables>
  <block type="sb_comment" id="switch_instr_guide" x="10" y="10">
    <field name="COMMENT">此範例展示如何「在演奏中即時切換音色」。&amp;#10;&amp;#10;1. 初始化階段：&amp;#10;我們建立了兩個樂器：Piano (PolySynth) 與 Strings (FMSynth)，&amp;#10;並分別為它們設定了不同的 ADSR 包絡（鋼琴短促、弦樂悠長）。&amp;#10;&amp;#10;2. 即時切換邏輯：&amp;#10;在「當收到 MIDI 音符」事件中：&amp;#10;- 彈奏 MIDI F3 (53) 時：切換到 Piano。&amp;#10;- 彈奏 MIDI G3 (55) 時：切換到 Strings。&amp;#10;- 彈奏 MIDI F#3 (54) 時：拍手。&amp;#10;- 彈奏 MIDI G# (56)或更高音：則會以「目前選定」的樂器發聲。&amp;#10;&amp;#10;您可以嘗試在演奏高音旋律時，利用左手按 53 或 55 鍵，&amp;#10;體驗像真實電子琴切換音色的效果！</field>
    <next>
      <block type="sb_create_synth_instrument" id="P5iGXg)EtXJH0Y=(Y,=]">
        <field name="NAME">Piano</field>
        <field name="TYPE">PolySynth</field>
        <next>
          <block type="sb_set_adsr" id="[txh:G]M_[6w#XU|tg@G">
            <field name="TARGET">Piano</field>
            <field name="A">0.01</field>
            <field name="D">0.4</field>
            <field name="S">0.2</field>
            <field name="R">0.5</field>
            <next>
              <block type="sb_create_synth_instrument" id="_Z:!CvC?DtZ=maOpDE|q">
                <field name="NAME">Strings</field>
                <field name="TYPE">FMSynth</field>
                <next>
                  <block type="sb_set_adsr" id="T[]%Ve*^UnVL7[X{v_[9">
                    <field name="TARGET">Strings</field>
                    <field name="A">0.5</field>
                    <field name="D">1</field>
                    <field name="S">1</field>
                    <field name="R">0.2</field>
                    <next>
                      <block type="sb_define_chord" id="Cd*N0!Ni`y?/AG+NZ.q.">
                        <field name="NAME">CM7</field>
                        <field name="NOTES_STRING">C4,E4,G4,B4</field>
                        <next>
                          <block type="sb_toggle_pc_keyboard_midi" id="R*d{U=|#L{zrNQxuj]n!">
                            <field name="ACTION">ON</field>
                            <next>
                              <block type="sb_map_key_to_chord" id="ab5Lg^i@CNb^H@1$Co.H">
                                <field name="KEY_CODE">KeyA</field>
                                <field name="CHORD_NAME">CM7</field>
                                <next>
                                  <block type="sb_map_midi_to_chord" id="$8vpgGwf[@M/Hogbc^n=">
                                    <field name="MIDI_NOTE">54</field>
                                    <field name="CHORD_NAME">CM7</field>
                                  </block>
                                </next>
                              </block>
                            </next>
                          </block>
                        </next>
                      </block>
                    </next>
                  </block>
                </next>
              </block>
            </next>
          </block>
        </next>
      </block>
    </next>
  </block>
  <block type="sb_midi_note_received" id="2!S1UNYIS7]+92=ml;VP" x="10" y="570">
    <field name="NOTE" id="4kFk$B_8VRtg9#,1otIT">note</field>
    <field name="VELOCITY" id="9:^.}}q,!02#XYYzHqxe">velocity</field>
    <field name="CHANNEL" id="mJCT}0J}/8Z6sm[$fiQ=">channel</field>
    <statement name="DO">
      <block type="controls_if" id="dYc^bag5yyg3,Tv}6od4">
        <value name="IF0">
          <block type="logic_compare" id="qEqLZc6]@EaYgZ,(X{(r">
            <field name="OP">EQ</field>
            <value name="A">
              <block type="variables_get" id="-D{S|V$fd[B%Sy(5n6{|">
                <field name="VAR" id="4kFk$B_8VRtg9#,1otIT">note</field>
              </block>
            </value>
            <value name="B">
              <block type="math_number" id=",DWi%IU@c;(XjKQwvo8N">
                <field name="NUM">53</field>
              </block>
            </value>
          </block>
        </value>
        <statement name="DO0">
          <block type="sb_select_current_instrument" id="b+!f5,dA3}kW-u,k~}x%">
            <field name="NAME">Piano</field>
          </block>
        </statement>
        <next>
          <block type="controls_if" id="g^X/c-C%4J)Sytp8E/`(">
            <value name="IF0">
              <block type="logic_compare" id=")-3an=$,=J4nJmgc6C*y">
                <field name="OP">EQ</field>
                <value name="A">
                  <block type="variables_get" id="p$4[.hh{k`Y0[d$i5O[u">
                    <field name="VAR" id="4kFk$B_8VRtg9#,1otIT">note</field>
                  </block>
                </value>
                <value name="B">
                  <block type="math_number" id="ifj]%N3_7sbr=]F/OZzu">
                    <field name="NUM">55</field>
                  </block>
                </value>
              </block>
            </value>
            <statement name="DO0">
              <block type="sb_select_current_instrument" id="j;TCpFBkk:~l_xIcdRdD">
                <field name="NAME">Strings</field>
              </block>
            </statement>
            <next>
              <block type="controls_if" id="Rn61u{S}%[]jg*e~)Ewp">
                <value name="IF0">
                  <block type="logic_compare" id="6}N!9~Ra,8TD$0Y$.z?:">
                    <field name="OP">EQ</field>
                    <value name="A">
                      <block type="variables_get" id="~}[FkiU6!/Q~|wu2Bj~-">
                        <field name="VAR" id="4kFk$B_8VRtg9#,1otIT">note</field>
                      </block>
                    </value>
                    <value name="B">
                      <block type="math_number" id="-i(uAy@Oo^yc@iI!1sT:">
                        <field name="NUM">54</field>
                      </block>
                    </value>
                  </block>
                </value>
                <statement name="DO0">
                  <block type="jazzkit_play_drum" id="2hRh]}xc5?uY7WyC8S$K">
                    <field name="DRUM_TYPE">D#1</field>
                    <value name="VELOCITY">
                      <shadow type="math_number" id="`B.;(;z-fe{6+]z+Ebb6">
                        <field name="NUM">1</field>
                      </shadow>
                    </value>
                  </block>
                </statement>
                <next>
                  <block type="controls_if" id="?13OvE`c%ym,s68O+];Z">
                    <value name="IF0">
                      <block type="logic_compare" id="I02x8nDG}#jNZIg:N$6C">
                        <field name="OP">GT</field>
                        <value name="A">
                          <block type="variables_get" id="T^f$kNlPxlv7Fs7ClSVM">
                            <field name="VAR" id="4kFk$B_8VRtg9#,1otIT">note</field>
                          </block>
                        </value>
                        <value name="B">
                          <block type="math_number" id="8clrk=@fIhhXEG8;p9Q(">
                            <field name="NUM">55</field>
                          </block>
                        </value>
                      </block>
                    </value>
                    <statement name="DO0">
                      <block type="sb_midi_play" id="H/:A1D4pd(IDytvd1aTZ">
                        <value name="NOTE">
                          <shadow type="variables_get" id="xr:N/mh#EVk.GBJB756n">
                            <field name="VAR" id="4kFk$B_8VRtg9#,1otIT">note</field>
                          </shadow>
                        </value>
                        <value name="VELOCITY">
                          <shadow type="variables_get" id="4_S9h7d([5+TnTt51gM1">
                            <field name="VAR" id="9:^.}}q,!02#XYYzHqxe">velocity</field>
                          </shadow>
                        </value>
                        <value name="CHANNEL">
                          <shadow type="variables_get" id="7n}PlFIqJMmR^T(I0hGR">
                            <field name="VAR" id="mJCT}0J}/8Z6sm[$fiQ=">channel</field>
                          </shadow>
                        </value>
                      </block>
                    </statement>
                  </block>
                </next>
              </block>
            </next>
          </block>
        </next>
      </block>
    </statement>
  </block>
</xml>