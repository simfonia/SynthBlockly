<xml xmlns="https://developers.google.com/blockly/xml">
  <variables>
    <variable id="%O$8`4%3bnA}gAPggU#:">serial_data</variable>
    <variable id="clean_data">clean_data</variable>
  </variables>
  <block type="sb_comment" id="guide" x="10" y="10">
    <field name="COMMENT">【TTP229 觸控和弦板】&amp;#10;&amp;#10;1. 建立音色：已在容器內定義長延音 Piano。&amp;#10;2. 定義和弦：從 C 到 Bdim 的常用階度和弦。&amp;#10;3. 邏輯對應：收到 "KEY:1" ~ "KEY:7" 時觸發對應和弦。&amp;#10;&amp;#10;配合 TTP229 觸控板，輕鬆用單指彈奏出專業伴奏！</field>
  </block>
  <block type="sb_instrument_container" id="c_piano" x="10" y="190">
    <field name="NAME">Piano</field>
    <statement name="STACK">
      <block type="sb_create_synth_instrument" id="k7^d}GM3=,nKkn^F#+)P">
        <field name="TYPE">PolySynth</field>
        <next>
          <block type="sb_container_adsr" id="iiOl5(jI9Qwk@ig]lGJ6">
            <field name="A">0.02</field>
            <field name="D">0.5</field>
            <field name="S">0.3</field>
            <field name="R">1.2</field>
          </block>
        </next>
      </block>
    </statement>
  </block>
  <block type="sb_define_chord" id="c_c" x="10" y="310">
    <field name="NAME">C</field>
    <field name="NOTES_STRING">C3,E3,G3</field>
    <next>
      <block type="sb_define_chord" id="c_dm">
        <field name="NAME">Dm</field>
        <field name="NOTES_STRING">D3,F3,A3</field>
        <next>
          <block type="sb_define_chord" id="c_em">
            <field name="NAME">Em</field>
            <field name="NOTES_STRING">E3,G3,B3</field>
            <next>
              <block type="sb_define_chord" id="c_f">
                <field name="NAME">F</field>
                <field name="NOTES_STRING">F3,A3,C4</field>
                <next>
                  <block type="sb_define_chord" id="c_g">
                    <field name="NAME">G</field>
                    <field name="NOTES_STRING">G3,B3,D4</field>
                    <next>
                      <block type="sb_define_chord" id="c_am">
                        <field name="NAME">Am</field>
                        <field name="NOTES_STRING">A3,C4,E4</field>
                        <next>
                          <block type="sb_define_chord" id="c_bdim">
                            <field name="NAME">Bdim</field>
                            <field name="NOTES_STRING">B3,D4,F4</field>
                          </block>
                        </next>
                      </block>
                    </next>
                  </block>
                </next>
              </block>
            </next>
          </block>
        </next>
      </block>
    </next>
  </block>
  <block type="sb_serial_data_received" id="serial_gate" x="10" y="530">
    <field name="DATA" id="%O$8`4%3bnA}gAPggU#:">serial_data</field>
    <statement name="DO">
      <block type="variables_set" id="v1">
        <field name="VAR" id="clean_data">clean_data</field>
        <value name="VALUE">
          <block type="text_trim" id="I6;R%[Z!KKO9g9CXcpVr">
            <field name="MODE">BOTH</field>
            <value name="TEXT">
              <block type="variables_get" id="p$iW3|/Rqg^z*-_41K6}">
                <field name="VAR" id="%O$8`4%3bnA}gAPggU#:">serial_data</field>
              </block>
            </value>
          </block>
        </value>
        <next>
          <block type="controls_if" id="if_chain">
            <mutation elseif="6"></mutation>
            <value name="IF0">
              <block type="logic_compare" id="1cuv_3bBKddZh#S))8xD">
                <field name="OP">EQ</field>
                <value name="A">
                  <block type="variables_get" id="O?fSj.?Fwv[Wib1D*Xst">
                    <field name="VAR" id="clean_data">clean_data</field>
                  </block>
                </value>
                <value name="B">
                  <block type="text" id="?|9z^;SdQ/:sQ,$5Yw])">
                    <field name="TEXT">KEY:1</field>
                  </block>
                </value>
              </block>
            </value>
            <statement name="DO0">
              <block type="sb_play_chord_by_name" id=")XB+JkLYzaSHkvD7}C6I">
                <field name="CHORD_NAME">C</field>
                <field name="DUR">4n</field>
              </block>
            </statement>
            <value name="IF1">
              <block type="logic_compare" id="o,^}E82fRT.kWj4-^n%~">
                <field name="OP">EQ</field>
                <value name="A">
                  <block type="variables_get" id="WOnV/oPl9]721;iab(U6">
                    <field name="VAR" id="clean_data">clean_data</field>
                  </block>
                </value>
                <value name="B">
                  <block type="text" id="ar@HoIsDZ,W!NS;^,+lc">
                    <field name="TEXT">KEY:2</field>
                  </block>
                </value>
              </block>
            </value>
            <statement name="DO1">
              <block type="sb_play_chord_by_name" id="345$8(.*_odkC4.OA^,:">
                <field name="CHORD_NAME">Dm</field>
                <field name="DUR">4n</field>
              </block>
            </statement>
            <value name="IF2">
              <block type="logic_compare" id="v4wS)v=Cz18Qw6={1BB9">
                <field name="OP">EQ</field>
                <value name="A">
                  <block type="variables_get" id=":_qWa-Yf.z.bD{m6KG!{">
                    <field name="VAR" id="clean_data">clean_data</field>
                  </block>
                </value>
                <value name="B">
                  <block type="text" id="QQ3RvAb(tA;82vQQ4A.7">
                    <field name="TEXT">KEY:3</field>
                  </block>
                </value>
              </block>
            </value>
            <statement name="DO2">
              <block type="sb_play_chord_by_name" id="DrMA|%5A55TKHIavtD8F">
                <field name="CHORD_NAME">Em</field>
                <field name="DUR">4n</field>
              </block>
            </statement>
            <value name="IF3">
              <block type="logic_compare" id="+A_h`a9NyB1Pqen}Jqz^">
                <field name="OP">EQ</field>
                <value name="A">
                  <block type="variables_get" id="P2O.RvlCU{k-(AsZc0iK">
                    <field name="VAR" id="clean_data">clean_data</field>
                  </block>
                </value>
                <value name="B">
                  <block type="text" id="%6G%4w$,A*.8++T)]G]+">
                    <field name="TEXT">KEY:4</field>
                  </block>
                </value>
              </block>
            </value>
            <statement name="DO3">
              <block type="sb_play_chord_by_name" id="knWoS9;,4JrQXbp7YC(Y">
                <field name="CHORD_NAME">F</field>
                <field name="DUR">4n</field>
              </block>
            </statement>
            <value name="IF4">
              <block type="logic_compare" id="}g;;hJ.k),d_#g(f1pqg">
                <field name="OP">EQ</field>
                <value name="A">
                  <block type="variables_get" id="=%~i,3#oN``M+#q1u;:P">
                    <field name="VAR" id="clean_data">clean_data</field>
                  </block>
                </value>
                <value name="B">
                  <block type="text" id="hxJxK-^dde|419~A(KU`">
                    <field name="TEXT">KEY:5</field>
                  </block>
                </value>
              </block>
            </value>
            <statement name="DO4">
              <block type="sb_play_chord_by_name" id="iWwIVD@Q9X]ZaYaTsp%)">
                <field name="CHORD_NAME">G</field>
                <field name="DUR">4n</field>
              </block>
            </statement>
            <value name="IF5">
              <block type="logic_compare" id="b=Tf+Ib*M7Y28h[kW5BH">
                <field name="OP">EQ</field>
                <value name="A">
                  <block type="variables_get" id="y??BpZ4vLYh0ZZ[/TjjO">
                    <field name="VAR" id="clean_data">clean_data</field>
                  </block>
                </value>
                <value name="B">
                  <block type="text" id="*d=^j|@@bbd#NdQ^{NG=">
                    <field name="TEXT">KEY:6</field>
                  </block>
                </value>
              </block>
            </value>
            <statement name="DO5">
              <block type="sb_play_chord_by_name" id=";3*Uw7.};SZwXQ:WvN?z">
                <field name="CHORD_NAME">Am</field>
                <field name="DUR">4n</field>
              </block>
            </statement>
            <value name="IF6">
              <block type="logic_compare" id="d@c=jr,oQfH#bAOR-eiL">
                <field name="OP">EQ</field>
                <value name="A">
                  <block type="variables_get" id="Zjj}I]0vk$uA8}2}kDhH">
                    <field name="VAR" id="clean_data">clean_data</field>
                  </block>
                </value>
                <value name="B">
                  <block type="text" id="Vj=@}q*282.j=tj~pzP(">
                    <field name="TEXT">KEY:7</field>
                  </block>
                </value>
              </block>
            </value>
            <statement name="DO6">
              <block type="sb_play_chord_by_name" id="U}PTC|d|dy$BN/x%ztG?">
                <field name="CHORD_NAME">Bdim</field>
                <field name="DUR">4n</field>
              </block>
            </statement>
          </block>
        </next>
      </block>
    </statement>
  </block>
</xml>