# SynthBlockly檔案結構

本文件說明 Vite 版本的 SynthBlockly 專案檔案結構。專案已經從傳統的全域腳本模式重構為使用 Vite 進行打包和管理的現代模組化架構。

- `synthblockly/`
  - `index.html`: Vite 專案的 HTML 主入口點。負責載入主腳本 `main.js`。
  - `main.js`: 應用程式的 **Vite 主入口點**。它的主要職責是匯入並啟動核心應用程式邏輯 `js/app.js`。
  - `styles.css`: 全域的 CSS 樣式表。
  - `package.json`: 定義專案依賴（如 Vite, Blockly, Tone.js）和執行腳本（如 `dev`, `build`）。
  - `public/`: 存放不會被 Vite 建置流程處理的靜態檔案，例如音訊樣本 (`samples/`)。`toolbox.xml` 已內嵌至 JS，`locales` 資料夾已無作用。
  - `examples/`: 存放 Blockly 工作區的 XML 範例檔案。
  - `js/`: **模組化的 JavaScript 原始碼**
    - `app.js`: **核心應用程式主入口**。負責初始化各個模組，是整個應用的指揮中心。
    - `core/`: **核心商業邏輯**
      - `audioEngine.js`: 封裝 Tone.js 的音訊引擎，負責管理樂器、**動態效果器鏈**和音訊播放。
      - `midiEngine.js`: 處理 Web MIDI API 的邏輯，包括設備連接和訊息監聽。
      - `serialEngine.js`: 處理 Web Serial API 的邏輯，用於與 Arduino 等硬體通訊。
      - `blocklyManager.js`: 負責 Blockly 工作區的初始化、事件監聽和動態積木邏輯。
      - `eventManager.js`: 集中管理由帽子積木註冊的各類事件監聽器。
      - `toolbox.js`: 新增檔案，內含 Blockly 工具箱的 XML 定義字串。
    - `ui/`: **使用者介面相關邏輯**
      - `dom.js`: 集中管理所有 DOM 元素的參考。
      - `buttons.js`: 處理所有 UI 按鈕的事件綁定。
      - `keyboardController.js`: 實現 PC 鍵盤模擬 MIDI 輸入的功能。
      - `resizer.js`: 管理 Blockly 工作區和 p5 畫布的縮放邏輯。
      - `visualizer.js`: 使用 p5.js 實現音訊的波形視覺化。
      - `logger.js`: 提供在前端介面顯示日誌的功能。
    - `blocks/`: **積木定義與生成器**
      - `index.js`: 統一註冊所有積木、生成器和語言檔的入口，並使用 `js/core/toolbox.js` 中的 XML 字串。
      - `instruments_blocks.js` / `instruments_generators.js`: 樂器相關積木。
      - `transport_blocks.js` / `transport_generators.js`: 節拍相關積木。
      - `effects_blocks.js` / `effects_generators.js`: 效果器相關積木。
      - `midi_blocks.js` / `midi_generators.js`: MIDI 相關積木。
      - `keyboard_blocks.js` / `keyboard_generators.js`: PC 鍵盤相關積木。
      - `serial_blocks.js` / `serial_generators.js`: 序列埠相關積木。
      - `math_blocks.js` / `math_generators.js`: 數學相關積木。
      - `lang/`: **Blockly 自訂語言檔案** (en.js, zh-hant.js)
        - `en.js`: 英文自訂語言設定，會與主要語言包合併。
        - `zh-hant.js`: 正體中文自訂語言設定，會與主要語言包合併。
  - `log/`: 存放開發日誌和任務清單。
    - `todo.md`: 專案的待辦事項清單。
    - `work.md`: 開發工作日誌。
  - `src/`: **(未使用)** Vite 初始化時產生的預設資料夾，目前專案的核心邏輯在 `js/` 資料夾中。